<%- layout("/layouts/basic.ejs") -%> 
<head>
  <!-- Font Awesome for Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <style>
    /* === FILTERS === */
    #fill {
      display: flex;
      align-items: center;
      overflow-x: auto;
      gap: 0.75rem;
      padding: 0.75rem;
      scrollbar-width: thin;
      flex-wrap: nowrap;
    }
    #filters {
      display: flex;
      flex-grow: 1;
      gap: 0.75rem;
      overflow-x: auto;
      flex-wrap: nowrap;
      padding-bottom: 0.25rem;
    }
    .filter1 {
      text-decoration: none;
      background-color: #fff;
      border: 1px solid #ddd;
      border-radius: 50px;
      padding: 0.45rem 0.9rem;
      font-size: 0.85rem;
      font-weight: 500;
      color: #333;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    .filter1:hover {
      background-color: #007bff;
      color: #fff;
      border-color: #007bff;
    }
    .filter1.active {
      background-color: #007bff;
      color: #fff;
      border-color: #007bff;
    }
    .material-icons {
      font-size: 1rem;
    }
    .tax-toggle {
      background: #fff;
      border: 1px solid #ddd;
      padding: 0.4rem 0.75rem;
      border-radius: 50px;
      margin-bottom: 21px;
      font-size: 0.85rem;
    }

    /* === LISTINGS GRID & CARDS === */
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      padding: 1rem;
      justify-content: center;
    }

    .listing-card {
      background: #fff;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.05);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      text-decoration: none;
      color: inherit;
      display: flex;
      flex-direction: column;
      width: 100%;
      max-width: 300px;
      border: 1px solid #e0e0e0;
    }

    .listing-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.08);
    }

    .listing-card img {
      width: 100%;
      height: 190px;
      object-fit: cover;
    }

    .card-body {
      padding: 1.1rem 1.25rem;
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
    }

    .card-body b {
      font-size: 1.1rem;
      font-weight: 600;
      color: #111;
      letter-spacing: 0.2px;
    }

    .vehicle-details {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      font-size: 0.88rem;
      color: #555;
      border-top: 1px solid #eee;
      padding-top: 0.6rem;
    }

    .vehicle-details span {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      line-height: 1.4;
    }

    .vehicle-details i {
      color: #007bff;
      width: 20px;
      font-size: 0.95rem;
    }

    /* Improved Price Styling */
    .price-container {
      margin-top: 0.5rem;
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
    }
    
    .base-price {
      font-size: 1rem;
      font-weight: 600;
      color: #222;
    }
    
    .tax-info {
      font-size: 0.8rem;
      color: #666;
      display: none; /* Hidden by default */
    }
    
    .total-price {
      font-size: 1.05rem;
      font-weight: 700;
      color: #007bff;
      display: none; /* Hidden by default */
      margin-top: 0.2rem;
    }
    
    .price-divider {
      display: none;
      font-size: 0.8rem;
      color: #999;
      text-align: center;
      margin: 0.2rem 0;
    }

    /* Responsive widths */
    @media (max-width: 600px) {
      .listing-card {
        max-width: 92%;
      }
    }
    @media (min-width: 601px) and (max-width: 991px) {
      .listing-card {
        max-width: 46%;
      }
    }
    @media (min-width: 992px) {
      .listing-card {
        max-width: 30%;
      }
    }
  </style>

  <div id="fill">
    <div id="filters">
      <a class="filter1 <%= !category ? 'active' : '' %>" href="/listings<%= city ? '/filter?city=' + city : '' %>">
        <span class="material-icons">clear_all</span> All
      </a>
      <a class="filter1 <%= category === 'car' ? 'active' : '' %>" href="/listings/filter?category=car<%= city ? '&city=' + city : '' %>">
        <span class="material-icons">local_taxi</span> Cars
      </a>
      <a class="filter1 <%= category === 'bike' ? 'active' : '' %>" href="/listings/filter?category=bike<%= city ? '&city=' + city : '' %>">
        <span class="material-icons">motorcycle</span> Bikes
      </a>
      <a class="filter1 <%= category === 'electric_car' ? 'active' : '' %>" href="/listings/filter?category=electric_car<%= city ? '&city=' + city : '' %>">
        <span class="material-icons">electric_car</span> Electric Car
      </a>
      <a class="filter1 <%= category === 'electric_bike' ? 'active' : '' %>" href="/listings/filter?category=electric_bike<%= city ? '&city=' + city : '' %>">
        <span class="material-icons">electric_bike</span> Electric Bike
      </a>
    </div>
    <div class="tax-toggle">
      <div class="form-check-reverse form-switch">
        <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault">
        <label class="form-check-label" for="flexSwitchCheckDefault">After Tax</label>
      </div>
    </div>
  </div>

  <!-- Listings -->
  <div class="row">
    <% if (allListings.length === 0) { %>
      <p>No listings match the selected category.</p>
    <% } else { %>
      <% for (let listing of allListings) { %>
        <a href="/listings/<%= listing._id %>" class="listing-card">
          <img src="<%= listing.image.url%>" alt="listing_image" />
          <div class="card-body">
            <b><%= listing.vname %></b>
            <div class="vehicle-details">
              <span><i class="fas fa-gas-pump"></i> <%= listing.vfuel %></span>
              <span><i class="fas fa-road"></i> <%= listing.vlimit %> km/day</span>
              <span><i class="fas fa-bolt"></i> <%= listing.vpower %> HP</span>
              <span><i class="fas fa-user-friends"></i> <%= listing.plimit %> passengers</span>
            </div>
            <div class="price-container">
              <div class="base-price">₹<%= listing.cost %> <span>/day</span></div>
              <div class="tax-info">+ ₹<%= Math.round(listing.cost * 0.18) %> GST (18%)</div>
              <div class="price-divider">───────</div>
              <div class="total-price mb-2">₹<%= Math.round(listing.cost * 1.18) %> <span>/day</span></div>
            </div>
          </div>
        </a>
      <% } %>
    <% } %>
  </div>

  <!-- Tax Toggle Script -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const taxSwitch = document.getElementById('flexSwitchCheckDefault');
      
      // Get all tax-related elements
      const taxInfoElements = document.querySelectorAll('.tax-info');
      const totalPriceElements = document.querySelectorAll('.total-price');
      const dividerElements = document.querySelectorAll('.price-divider');
      
      taxSwitch.addEventListener('change', function() {
        const isChecked = this.checked;
        
        // Toggle visibility of all tax-related elements
        taxInfoElements.forEach(info => {
          info.style.display = isChecked ? 'block' : 'none';
        });
        
        totalPriceElements.forEach(price => {
          price.style.display = isChecked ? 'block' : 'none';
        });
        
        dividerElements.forEach(divider => {
          divider.style.display = isChecked ? 'block' : 'none';
        });
      });
    });
  </script>
</body>                                                                                                                